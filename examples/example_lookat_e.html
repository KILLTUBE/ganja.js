<script type="module">
import Algebra from "../ganja.js"; // enki's version + export default Algebra
//import Algebra from "../src/index.js"; // kungfooman's version
Algebra(3,0,1,()=>{
  const point = (x,y)=>!(1e0 + x*1e1 + y*1e2);

  var A = !(1e0+0.5e1+.3e2-.5e3),
      B = !(1e0-1e3);
      
  var cam_model = [
        [!1e0,!(1e0-.2e3)],
        [!(1e0-.2e3+.1e1),!(1e0-.2e3-.1e1)],
        [!(1e0-.3e3),!(1e0-.2e3-.1e1)],
        [!(1e0-.3e3),!(1e0-.2e3+.1e1)],
        [!1e0,!(1e0+.1e2)]
      ]
    
  var align = (p,q)=>{
    for (var i=0, M=1, P=!1, Q=!1; i<p.length; ++i) {
      P = Q & (M >>> p[i]);
      Q = Q & q[i];
      M = (1 + Q.Normalized / P.Normalized).Normalized * M;
    }
    return M
  }

  var lerp = (m,t)=>((1 - t) + t * m).Normalized;

  var path = (m, steps, x)=>[...Array(steps)].map((e,i)=>lerp(m,i/(steps-1)) >>> x);

  var svg = this.graph(()=>{
    var t = 0.5 + 0.5 * Math.sin(performance.now()/1000);
    return [
      0xFFEEEE, ...path(align([!1e0,!-1e3,!1e2],[A,B,!1e2]),10,cam_model).flat(),
      0xFF0000, ...align([!1e0,!-1e3,!1e2],[A,B,!1e2]) >>> cam_model,
      0x224488, A,"A", B,"B"
  ]
  },{
    grid:1,
    scale:1.5,
    fontSize:2,
    pointRadius:2,
    lineWidth:5,
  });

  svg.style.width = '600px';
  svg.style.height = '600px';
  svg.style.background = 'white';

  document.body.appendChild(svg);
});
</script>
